AjaxSolr=function(){};AjaxSolr.Class=function(){};AjaxSolr.Class.extend=function(b){var a=this;var c=function(d){AjaxSolr.extend(this,new a(d),b,d)};c.extend=this.extend;return c};AjaxSolr.size=function(c){var b=0;for(var a in c){if(c.hasOwnProperty(a)){b++}}return b};AjaxSolr.equals=function(d,c){if(AjaxSolr.isArray(d)&&AjaxSolr.isArray(c)){if(d.length!==c.length){return false}for(var b=0,a=d.length;b<a;b++){if(d[b]!==c[b]){return false}}return true}else{if(AjaxSolr.isRegExp(d)&&AjaxSolr.isString(c)){return c.match(d)}else{if(AjaxSolr.isRegExp(c)&&AjaxSolr.isString(d)){return d.match(c)}else{return d===c}}}};AjaxSolr.inArray=function(c,d){if(d){for(var b=0,a=d.length;b<a;b++){if(AjaxSolr.equals(d[b],c)){return b}}}return -1};AjaxSolr.flatten=function(d){var b=[];for(var c=0,a=d.length;c<a;c++){b=b.concat(AjaxSolr.isArray(d[c])?AjaxSolr.flatten(d[c]):d[c])}return b};AjaxSolr.grep=function(e,d){var b=[];for(var c=0,a=e.length;c<a;c++){if(!d(e[c],c)===false){b.push(e[c])}}return b};AjaxSolr.compact=function(a){return AjaxSolr.grep(a,function(b){return b.toString()})};AjaxSolr.isArray=function(a){return a!=null&&typeof a=="object"&&"splice" in a&&"join" in a};AjaxSolr.isRegExp=function(a){return a!=null&&(typeof a=="object"||typeof a=="function")&&"ignoreCase" in a};AjaxSolr.isString=function(a){return a!=null&&typeof a=="string"};AjaxSolr.theme=function(c){if(AjaxSolr.theme[c]||AjaxSolr.theme.prototype[c]==undefined){console.log('Theme function "'+c+'" is not defined.')}else{for(var b=1,a=[];b<arguments.length;b++){a.push(arguments[b])}return(AjaxSolr.theme[c]||AjaxSolr.theme.prototype[c]).apply(this,a)}};AjaxSolr.extend=function(){var e=arguments[0]||{},c=1,d=arguments.length,b;for(;c<d;c++){if((b=arguments[c])!=null){for(var a in b){var f=e[a],g=b[a];if(e===g){continue}if(g&&typeof g=="object"&&!g.nodeType){e[a]=AjaxSolr.extend(f||(g.length!=null?[]:{}),g)}else{if(g&&f&&typeof g=="function"&&typeof f=="function"){e[a]=(function(i,h){return function(){var k=this._super,j;this._super=i;j=h.apply(this,arguments);this._super=k;return j}})(f,g)}else{if(g!==undefined){e[a]=g}}}}}}return e};AjaxSolr.AbstractManager=AjaxSolr.Class.extend({solrUrl:"http://localhost:8983/solr/",proxyUrl:null,servlet:"select",response:{},widgets:{},store:null,initialized:false,init:function(){this.initialized=true;if(this.store===null){this.setStore(new AjaxSolr.ParameterStore())}this.store.load(false);for(var a in this.widgets){this.widgets[a].init()}this.store.init()},setStore:function(a){a.manager=this;this.store=a},addWidget:function(a){a.manager=this;this.widgets[a.id]=a},doRequest:function(c,b){if(this.initialized===false){this.init()}if(c!==undefined){this.store.get("start").val(c)}if(b===undefined){b=this.servlet}this.store.save();for(var a in this.widgets){this.widgets[a].beforeRequest()}this.executeRequest(b)},executeRequest:function(a){throw"Abstract method executeRequest must be overridden in a subclass."},handleResponse:function(b){this.response=b;for(var a in this.widgets){this.widgets[a].afterRequest()}}});AjaxSolr.Manager=AjaxSolr.AbstractManager.extend({executeRequest:function(d,b,c){var a=this;b=b||this.store.string();c=c||function(e){a.handleResponse(e)};if(this.proxyUrl){jQuery.post(this.proxyUrl,{query:b},c,"json")}else{jQuery.getJSON(this.solrUrl+d+"?"+b+"&wt=json&json.wrf=?",{},c)}}});AjaxSolr.Parameter=AjaxSolr.Class.extend({name:null,value:null,locals:{},val:function(a){if(a===undefined){return this.value}else{this.value=a}},local:function(a,b){if(b===undefined){return this.locals[a]}else{this.locals[a]=b}},remove:function(a){delete this.locals[a]},string:function(){var c=[];for(var a in this.locals){if(this.locals[a]){c.push(a+"="+encodeURIComponent(this.locals[a]))}}var b=c.length?"{!"+c.join("%20")+"}":"";if(this.value){return this.name+"="+b+this.valueString(this.value)}else{if(this.name=="q"&&b){return"q.alt="+b+encodeURIComponent("*:*")}else{return""}}},parseString:function(c){var b=c.match(/^([^=]+)=(?:\{!([^\}]*)\})?(.*)$/);if(b){var a;while(a=/([^\s=]+)=(\S*)/g.exec(decodeURIComponent(b[2]))){this.locals[a[1]]=decodeURIComponent(a[2]);b[2]=b[2].replace(a[0],"")}if(b[1]=="q.alt"){this.name="q"}else{this.name=b[1];this.value=this.parseValueString(b[3])}}},valueString:function(a){a=AjaxSolr.isArray(a)?a.join(","):a;return encodeURIComponent(a)},parseValueString:function(a){a=decodeURIComponent(a);return a.indexOf(",")==-1?a:a.split(",")}});AjaxSolr.Parameter.escapeValue=function(a){if(a.match(/[ :\/"]/)&&!a.match(/[\[\{]\S+ TO \S+[\]\}]/)&&!a.match(/^["\(].*["\)]$/)){return'"'+a.replace(/\\/g,"\\\\").replace(/"/g,'\\"')+'"'}return a};AjaxSolr.ParameterStore=AjaxSolr.Class.extend({exposed:[],params:{},manager:null,init:function(){},isMultiple:function(a){return a.match(/^(?:bf|bq|facet\.date|facet\.date\.other|facet\.date\.include|facet\.field|facet\.pivot|facet\.range|facet\.range\.other|facet\.range\.include|facet\.query|fq|group\.field|group\.func|group\.query|pf|qf)$/)},get:function(a){if(this.params[a]===undefined){var b=new AjaxSolr.Parameter({name:a});if(this.isMultiple(a)){this.params[a]=[b]}else{this.params[a]=b}}return this.params[a]},values:function(c){if(this.params[c]!==undefined){if(this.isMultiple(c)){var b=[];for(var d=0,a=this.params[c].length;d<a;d++){b.push(this.params[c][d].val())}return b}else{return[this.params[c].val()]}}return[]},add:function(a,b){if(b===undefined){b=new AjaxSolr.Parameter({name:a})}if(this.isMultiple(a)){if(this.params[a]===undefined){this.params[a]=[b]}else{if(AjaxSolr.inArray(b.val(),this.values(a))==-1){this.params[a].push(b)}else{return false}}}else{this.params[a]=b}return b},remove:function(b,a){if(a===undefined){delete this.params[b]}else{this.params[b].splice(a,1);if(this.params[b].length==0){delete this.params[b]}}},find:function(b,d){if(this.params[b]!==undefined){if(this.isMultiple(b)){var e=[];for(var c=0,a=this.params[b].length;c<a;c++){if(AjaxSolr.equals(this.params[b][c].val(),d)){e.push(c)}}return e.length?e:false}else{if(AjaxSolr.equals(this.params[b].val(),d)){return b}}}return false},addByValue:function(c,e,f){if(f===undefined){f={}}if(this.isMultiple(c)&&AjaxSolr.isArray(e)){var b=[];for(var d=0,a=e.length;d<a;d++){b.push(this.add(c,new AjaxSolr.Parameter({name:c,value:e[d],locals:f})))}return b}else{return this.add(c,new AjaxSolr.Parameter({name:c,value:e,locals:f}))}},removeByValue:function(a,c){var d=this.find(a,c);if(d){if(AjaxSolr.isArray(d)){for(var b=d.length-1;b>=0;b--){this.remove(a,d[b])}}else{this.remove(d)}}return d},string:function(){var d=[];for(var b in this.params){if(this.isMultiple(b)){for(var c=0,a=this.params[b].length;c<a;c++){d.push(this.params[b][c].string())}}else{d.push(this.params[b].string())}}return AjaxSolr.compact(d).join("&")},parseString:function(e){var c=e.split("&");for(var b=0,a=c.length;b<a;b++){if(c[b]){var d=new AjaxSolr.Parameter();d.parseString(c[b]);this.add(d.name,d)}}},exposedString:function(){var e=[];for(var d=0,b=this.exposed.length;d<b;d++){if(this.params[this.exposed[d]]!==undefined){if(this.isMultiple(this.exposed[d])){for(var c=0,a=this.params[this.exposed[d]].length;c<a;c++){e.push(this.params[this.exposed[d]][c].string())}}else{e.push(this.params[this.exposed[d]].string())}}}return AjaxSolr.compact(e).join("&")},exposedReset:function(){for(var b=0,a=this.exposed.length;b<a;b++){this.remove(this.exposed[b])}},load:function(a){if(a===undefined){a=true}if(a){this.exposedReset()}this.parseString(this.storedString())},save:function(){},storedString:function(){return""}});AjaxSolr.ParameterStore=AjaxSolr.Class.extend({exposed:[],params:{},manager:null,init:function(){},isMultiple:function(a){return a.match(/^(?:bf|bq|facet\.date|facet\.date\.other|facet\.date\.include|facet\.field|facet\.pivot|facet\.range|facet\.range\.other|facet\.range\.include|facet\.query|fq|group\.field|group\.func|group\.query|pf|qf)$/)},get:function(a){if(this.params[a]===undefined){var b=new AjaxSolr.Parameter({name:a});if(this.isMultiple(a)){this.params[a]=[b]}else{this.params[a]=b}}return this.params[a]},values:function(c){if(this.params[c]!==undefined){if(this.isMultiple(c)){var b=[];for(var d=0,a=this.params[c].length;d<a;d++){b.push(this.params[c][d].val())}return b}else{return[this.params[c].val()]}}return[]},add:function(a,b){if(b===undefined){b=new AjaxSolr.Parameter({name:a})}if(this.isMultiple(a)){if(this.params[a]===undefined){this.params[a]=[b]}else{if(AjaxSolr.inArray(b.val(),this.values(a))==-1){this.params[a].push(b)}else{return false}}}else{this.params[a]=b}return b},remove:function(b,a){if(a===undefined){delete this.params[b]}else{this.params[b].splice(a,1);if(this.params[b].length==0){delete this.params[b]}}},find:function(b,d){if(this.params[b]!==undefined){if(this.isMultiple(b)){var e=[];for(var c=0,a=this.params[b].length;c<a;c++){if(AjaxSolr.equals(this.params[b][c].val(),d)){e.push(c)}}return e.length?e:false}else{if(AjaxSolr.equals(this.params[b].val(),d)){return b}}}return false},addByValue:function(c,e,f){if(f===undefined){f={}}if(this.isMultiple(c)&&AjaxSolr.isArray(e)){var b=[];for(var d=0,a=e.length;d<a;d++){b.push(this.add(c,new AjaxSolr.Parameter({name:c,value:e[d],locals:f})))}return b}else{return this.add(c,new AjaxSolr.Parameter({name:c,value:e,locals:f}))}},removeByValue:function(a,c){var d=this.find(a,c);if(d){if(AjaxSolr.isArray(d)){for(var b=d.length-1;b>=0;b--){this.remove(a,d[b])}}else{this.remove(d)}}return d},string:function(){var d=[];for(var b in this.params){if(this.isMultiple(b)){for(var c=0,a=this.params[b].length;c<a;c++){d.push(this.params[b][c].string())}}else{d.push(this.params[b].string())}}return AjaxSolr.compact(d).join("&")},parseString:function(e){var c=e.split("&");for(var b=0,a=c.length;b<a;b++){if(c[b]){var d=new AjaxSolr.Parameter();d.parseString(c[b]);this.add(d.name,d)}}},exposedString:function(){var e=[];for(var d=0,b=this.exposed.length;d<b;d++){if(this.params[this.exposed[d]]!==undefined){if(this.isMultiple(this.exposed[d])){for(var c=0,a=this.params[this.exposed[d]].length;c<a;c++){e.push(this.params[this.exposed[d]][c].string())}}else{e.push(this.params[this.exposed[d]].string())}}}return AjaxSolr.compact(e).join("&")},exposedReset:function(){for(var b=0,a=this.exposed.length;b<a;b++){this.remove(this.exposed[b])}},load:function(a){if(a===undefined){a=true}if(a){this.exposedReset()}this.parseString(this.storedString())},save:function(){},storedString:function(){return""}});AjaxSolr.AbstractWidget=AjaxSolr.Class.extend({id:null,target:null,manager:null,start:undefined,servlet:undefined,init:function(){},beforeRequest:function(){},afterRequest:function(){},doRequest:function(b,a){this.manager.doRequest(b||this.start,a||this.servlet)}});AjaxSolr.AbstractTextWidget=AjaxSolr.AbstractWidget.extend({start:0,set:function(a){return this.changeSelection(function(){this.manager.store.get("q").val(a)})},clear:function(){return this.changeSelection(function(){this.manager.store.remove("q")})},changeSelection:function(a){var b=this.manager.store.get("q").val();a.apply(this);var c=this.manager.store.get("q").val();if(c!==b){this.afterChangeSelection(c)}return c!==b},afterChangeSelection:function(a){},unclickHandler:function(){var a=this;return function(){if(a.clear()){a.doRequest()}return false}},clickHandler:function(b){var a=this;return function(){if(a.set(b)){a.doRequest()}return false}}});